<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Driver Registration | TravelMate</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
        rel="stylesheet">

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #eef2ff, #dbeafe);
    }

    .section-title {
      font-size: 22px;
      font-weight: 600;
      color: #4f46e5;
      margin-bottom: 12px;
    }

    .input {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
    }

    /* Preview box */
    .preview-box {
      width: 100%;
      height: 150px;
      border: 2px dashed #c4c4c4;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fafafa;
      transition: 0.3s;
      cursor: pointer;
    }

    .preview-box:hover {
      border-color: #6366f1;
    }

    .preview-img {
      width: 100%;
      height: 100%;
      display: none;
      object-fit: cover;
    }

    /* Shake animation */
    .shake {
      animation: shake 0.3s ease-in-out;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      50% { transform: translateX(4px); }
      75% { transform: translateX(-4px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>

<body class="min-h-screen flex justify-center items-center p-6">
<!-- Back Button -->
<div class="mb-4">
  <a href="{% url 'driverLogin' %}" 
     class="inline-block text-sm bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">
    ‚¨Ö Back
  </a>
</div>

  <div class="bg-white w-full max-w-4xl p-8 rounded-2xl shadow-xl">

   <!-- üîî PROFESSIONAL MESSAGES -->
{% if messages %}
<div class="mb-6 space-y-4">
  {% for message in messages %}
    <div class="flex items-start gap-3 p-4 rounded-xl shadow-sm border text-sm font-medium
      {% if message.tags == 'success' %}
        bg-green-50 text-green-800 border-green-200
      {% elif message.tags == 'error' %}
        bg-red-50 text-red-800 border-red-200
      {% elif message.tags == 'warning' %}
        bg-yellow-50 text-yellow-800 border-yellow-200
      {% else %}
        bg-blue-50 text-blue-800 border-blue-200
      {% endif %}
    ">

      <!-- Icon -->
      <div>
        {% if message.tags == 'success' %}
          ‚úÖ
        {% elif message.tags == 'error' %}
          ‚ùå
        {% elif message.tags == 'warning' %}
          ‚ö†
        {% else %}
          ‚Ñπ
        {% endif %}
      </div>

      <!-- Message Text -->
      <div class="flex-1">
        {{ message }}
      </div>

    </div>
  {% endfor %}
</div>
{% endif %}

    <h1 class="text-2xl font-semibold text-indigo-600 text-center mb-6">
      Driver Registration
    </h1>

    <form id="driverForm" method="POST" enctype="multipart/form-data"
          class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {% csrf_token %}

      <!-- ================= PERSONAL INFO ================= -->
      <div class="md:col-span-2">
        <h3 class="section-title">Personal Information</h3>
      </div>

      <div>
        <label class="font-medium">Full Name *</label>
        <input type="text" id="name" name="name" required minlength="2" class="input">
        <p id="nameError" class="text-red-500 text-xs mt-1 hidden">Enter at least 2 characters</p>
      </div>

      <div>
        <label class="font-medium">Email *</label>
        <input type="email" id="email" name="email" required class="input">
        <p id="emailError" class="text-red-500 text-xs mt-1 hidden">Invalid email</p>
      </div>

      <div>
        <label class="font-medium">Password *</label>
        <input type="password" id="password" name="password" required minlength="6" class="input">
        <p id="strengthMsg" class="text-xs font-semibold mt-1"></p>
      </div>

      <div>
        <label class="font-medium">Confirm Password *</label>
        <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" class="input">
        <p id="confirmError" class="text-red-500 text-xs mt-1 hidden">Passwords do not match</p>
      </div>

      <div>
        <label class="font-medium">Mobile Number *</label>
        <input type="text" id="phone" name="phoneNumber" required maxlength="10" class="input">
        <p id="phoneError" class="text-red-500 text-xs mt-1 hidden">Enter a valid 10-digit number</p>
      </div>

      <div>
        <label class="font-medium">Location *</label>
        <input type="text" id="location" name="location" required class="input">
      </div>

      <div class="md:col-span-2">
        <label class="font-medium">Full Address *</label>
        <textarea id="address" name="address" rows="3" required class="input"></textarea>
      </div>

            <div class="md:col-span-2">
        <label class="font-medium">Driver Fee *</label>
        <input type="text" id="driverFee" name="driver_fee" required class="input">
      </div>

      <!-- ================= PROFILE IMAGE ================= -->
      <div>
        <label class="font-medium">Profile Photo *</label>
        <div id="profileBox" class="preview-box">
          <img id="profilePreview" class="preview-img">
          <span class="text-gray-400 text-sm">Click to upload</span>
        </div>
        <input type="file" id="profile" name="profile_image" accept="image/*"
               class="hidden" required>
      </div>

      <!-- ================= LICENSE INFO ================= -->
      <div class="md:col-span-2 mt-6">
        <h3 class="section-title">License Details</h3>
      </div>

      <div>
        <label class="font-medium">Licence Number *</label>
        <input type="text" id="licNo" name="license_number" required class="input">
      </div>

      <div>
        <label class="font-medium">Expiry Date *</label>
        <input type="date" id="licDate" name="license_expiry" required class="input">
        <p id="dateError" class="text-red-500 text-xs mt-1 hidden">Expiry cannot be past date</p>
      </div>

      <div>
        <label class="font-medium">License Image *</label>

        <div id="licBox" class="preview-box">
          <img id="licPreview" class="preview-img">
          <span class="text-gray-400 text-sm">Click to upload</span>
        </div>

        <input type="file" id="licImage" name="license_image"
               class="hidden" accept="image/*" required>
      </div>

      <!-- ================= BANK DETAILS ================= -->
      <div class="md:col-span-2 mt-6">
        <h3 class="section-title">Bank Details</h3>
      </div>

      <div>
        <label class="font-medium">Account Number *</label>
        <input type="text" id="accNo" name="bank_account" required class="input">
      </div>

      <div>
        <label class="font-medium">IFSC Code *</label>
        <input type="text" id="ifsc" name="ifsc" maxlength="11" required class="input">
        <p id="ifscError" class="text-red-500 text-xs mt-1 hidden">Invalid IFSC format</p>
      </div>

      <div class="md:col-span-2">
        <button type="submit"
                class="w-full bg-indigo-600 text-white py-3 rounded-xl text-lg font-medium hover:bg-indigo-700">
          Register as Driver
        </button>
      </div>

    </form>

    <!-- SUCCESS BOX -->
    <div id="successBox" class="hidden text-center mt-10">
      <div class="text-green-600 text-5xl">‚úî</div>
      <h2 class="text-3xl font-bold text-green-700">Registration Successful!</h2>
    </div>

  </div>

  <!-- ======================== JAVASCRIPT ======================== -->
  <script>
    // CLICK PREVIEW BOX TO OPEN FILE
    document.getElementById("profileBox").onclick = () => document.getElementById("profile").click();
    document.getElementById("licBox").onclick = () => document.getElementById("licImage").click();

    // IMAGE PREVIEW FUNCTION
    function previewImage(input, preview) {
      input.addEventListener("change", () => {
        const file = input.files[0];
        if (file) {
          preview.src = URL.createObjectURL(file);
          preview.style.display = "block";
          preview.parentElement.querySelector("span")?.remove();
        }
      });
    }
    previewImage(profile, profilePreview);
    previewImage(licImage, licPreview);

    // PASSWORD STRENGTH
    document.getElementById("password").addEventListener("input", function () {
      let val = this.value;
      let msg = document.getElementById("strengthMsg");

      if (val.length < 6) {
        msg.textContent = "Weak Password";
        msg.className = "text-red-500 text-xs font-semibold";
      } else if (/[A-Z]/.test(val) || /[0-9]/.test(val)) {
        msg.textContent = "Medium Strength";
        msg.className = "text-yellow-500 text-xs font-semibold";
      } else {
        msg.textContent = "Strong Password";
        msg.className = "text-green-600 text-xs font-semibold";
      }
    });

    // MATCHING PASSWORD
    document.getElementById("confirmPassword").addEventListener("input", function () {
      const err = document.getElementById("confirmError");
      err.classList.toggle("hidden", this.value === password.value);
    });

    // IFSC VALIDATION
    document.getElementById("ifsc").addEventListener("input", function () {
      this.value = this.value.toUpperCase();
      const pattern = /^[A-Z]{4}0[A-Z0-9]{6}$/;
      const err = document.getElementById("ifscError");
      err.classList.toggle("hidden", pattern.test(this.value));
    });

    // EXPIRY DATE VALIDATION
    document.getElementById("licDate").addEventListener("change", function () {
      const today = new Date().toISOString().split("T")[0];
      const err = document.getElementById("dateError");
      err.classList.toggle("hidden", this.value >= today);
    });

    // FINAL FORM VALIDATION
 document.getElementById("driverForm").addEventListener("submit", function (e) {


      const fields = document.querySelectorAll("input[required], textarea[required]");
      let valid = true;

      fields.forEach(f => {
        if (!f.value.trim()) {
          f.classList.add("shake", "border-red-500");
          setTimeout(() => f.classList.remove("shake"), 300);
          valid = false;
        }
      });

     
    });
  </script>

</body>
</html>
