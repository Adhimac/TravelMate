<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Approve Drivers | TravelMate Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      background-color: #f4f6fb;
      font-family: Inter, sans-serif;
    }
    .row-hover:hover {
      background-color: #f9fafb !important;
      cursor: pointer;
    }
    @keyframes slideUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .animate-slideUp { animation: slideUp .3s ease-out; }
  </style>
</head>

<body class="p-8">

  <!-- PAGE HEADER -->
  <div class="mb-6">
    <a href="{% url 'adminHome' %}" 
       class="inline-block mb-4 text-sm bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">
      ⬅ Back
    </a>
    <h1 class="text-2xl font-semibold text-gray-800">Driver Approval Requests</h1>
    <p class="text-sm text-gray-500 mt-1">Review driver details and approve or reject registrations.</p>
  </div>

  <!-- TABLE -->
  <div class="bg-white rounded-xl shadow-sm overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-gray-50 border-b">
        <tr class="text-left text-gray-600">
          <th class="px-6 py-4">Name</th>
          <th class="px-6 py-4">Email</th>
          <th class="px-6 py-4">Phone</th>
          <th class="px-6 py-4">Profile Photo</th>
          <th class="px-6 py-4">Licence Image</th>
          <th class="px-6 py-4">Licence No</th>
          <th class="px-6 py-4">Location</th>
          <th class="px-6 py-4">Action</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        {% for driver in drivers %}
      <tr class="row-hover">


          <td class="px-6 py-4 font-medium text-gray-800">{{ driver.name }}</td>
          <td class="px-6 py-4 text-gray-600">{{ driver.email }}</td>
          <td class="px-6 py-4 text-gray-600">{{ driver.phoneNumber|default:"-" }}</td>

          <!-- PROFILE IMAGE -->
          <td class="px-6 py-4"
              onclick="event.stopPropagation(); showImage('{{ driver.profileImage.url }}')">
            {% if driver.profileImage %}
              <img src="{{ driver.profileImage.url }}"
                   class="w-16 h-16 rounded-full shadow cursor-pointer object-cover">
            {% else %}-{% endif %}
          </td>

          <!-- LICENCE IMAGE -->
          <td class="px-6 py-4"
              onclick="event.stopPropagation(); showImage('{{ driver.licenceImage.url }}')">
            {% if driver.licenceImage %}
              <img src="{{ driver.licenceImage.url }}"
                   class="w-16 h-16 rounded shadow cursor-pointer object-cover">
            {% else %}-{% endif %}
          </td>

          <td class="px-6 py-4 text-gray-600">{{ driver.licenceNumber }}</td>
          <td class="px-6 py-4 text-gray-600">{{ driver.location|default:"-" }}</td>
<td class="px-6 py-4 space-x-2"
    onclick="event.stopPropagation();">

    <!-- VIEW DETAILS BUTTON -->
    <button onclick="event.stopPropagation(); openDetailsModal({{ driver.id }})"
      class="px-4 py-2 bg-blue-600 text-white rounded-lg text-xs hover:bg-blue-700">
      View Details
    </button>

    <a href="{% url 'approveDriver' driver.id %}"
       class="px-4 py-2 bg-green-600 text-white rounded-lg text-xs hover:bg-green-700">
      Approve
    </a>

    <a href="{% url 'rejectDriver' driver.id %}"
       class="px-4 py-2 bg-red-600 text-white rounded-lg text-xs hover:bg-red-700">
      Reject
    </a>

</td>


        </tr>

        {% empty %}
        <tr>
          <td colspan="8" class="px-6 py-6 text-center text-gray-500">No pending driver requests.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>



  <!-- FULL DRIVER DETAILS POPUP -->
  <div id="detailsModal"
       class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50 p-4">

    <div class="bg-white w-full max-w-4xl rounded-2xl shadow-xl p-6 relative animate-slideUp">

      <!-- CLOSE BUTTON -->
      <button onclick="closeDetailsModal()"
              class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-black px-3 py-1 rounded-full">
        ✕
      </button>

      <h2 class="text-2xl font-bold mb-6 text-gray-800">Driver Full Details</h2>

      <div id="driverDetailsContent"></div>

    </div>
  </div>



  <!-- IMAGE POPUP VIEWER (Perfect Center) -->
  <div id="imageModal"
       class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center">

    <div id="modalContent"
         class="relative scale-90 opacity-0 transition-all duration-300">

      <img id="modalImage"
           class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl border border-white/20">

      <button onclick="closeModal()"
              class="absolute -top-5 -right-5 bg-white text-black px-3 py-1.5 rounded-full shadow-lg">✕</button>
    </div>
  </div>



  <!-- SCRIPT -->
  <script>
 const drivers = {{ drivers_json|safe }};


  function openDetailsModal(id) {
    const d = drivers.find(driver => driver.id === id);
    if (!d) return;

    let html = `
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

        <!-- LEFT COLUMN -->
        <div>
          <h3 class="text-lg font-semibold mb-3 text-gray-700">Personal Information</h3>
          <p><strong>Name:</strong> ${d.name}</p>
          <p><strong>Email:</strong> ${d.email}</p>
          <p><strong>Phone:</strong> ${d.phoneNumber ?? '-'}</p>
          <p><strong>Location:</strong> ${d.location ?? '-'}</p>
          <p><strong>Address:</strong> ${d.address ?? '-'}</p>
          <p><strong>Driver Fee:</strong> ₹${d.driver_fee ?? '-'}</p>

          <h3 class="text-lg font-semibold mt-6 mb-3 text-gray-700">Licence Details</h3>
          <p><strong>Licence Number:</strong> ${d.licenceNumber}</p>
          <p><strong>Licence Expiry:</strong> ${d.licenceExpiry ?? '-'}</p>
        </div>

        <!-- RIGHT COLUMN IMAGES -->
        <div>
          <h3 class="text-lg font-semibold mb-3 text-gray-700">Images</h3>

          <p class="font-medium mt-2">Profile Photo:</p>
          ${d.profileImage 
            ? `<img src="${d.profileImage}" onclick="showImage('${d.profileImage}')" class="w-40 h-40 object-cover rounded-xl shadow cursor-pointer">`
            : `<p>-</p>`}

          <p class="font-medium mt-4">Licence Image:</p>
          ${d.licenceImage 
            ? `<img src="${d.licenceImage}" onclick="showImage('${d.licenceImage}')" class="w-40 h-40 object-cover rounded-xl shadow cursor-pointer">`
            : `<p>-</p>`}
        </div>

      </div>

      <!-- BANK DETAILS -->
      <div class="mt-8 border-t pt-6">
        <h3 class="text-lg font-semibold mb-3 text-gray-700">Bank Information</h3>
        <p><strong>Account No:</strong> ${d.bank_account ?? '-'}</p>
        <p><strong>IFSC Code:</strong> ${d.ifsc ?? '-'}</p>
      </div>

      <!-- BUTTONS -->
      {% comment %} <div class="mt-8 flex justify-end gap-4">
        <a href="/approveDriver/${d.id}/"
           class="px-6 py-3 bg-green-600 text-white rounded-xl text-sm font-semibold hover:bg-green-700">
           Approve
        </a>
        <a href="/rejectDriver/${d.id}/"
           class="px-6 py-3 bg-red-600 text-white rounded-xl text-sm font-semibold hover:bg-red-700">
           Reject
        </a>
      </div> {% endcomment %}
    `;

    document.getElementById("driverDetailsContent").innerHTML = html;
    document.getElementById("detailsModal").classList.remove("hidden");
  }


  function closeDetailsModal() {
    document.getElementById("detailsModal").classList.add("hidden");
  }



  /* IMAGE POPUP */
  function showImage(src) {
    const modal = document.getElementById("imageModal");
    const modalContent = document.getElementById("modalContent");
    const modalImg = document.getElementById("modalImage");

    modalImg.src = src;
    modal.classList.remove("hidden");

    setTimeout(() => {
      modalContent.classList.add("opacity-100", "scale-100");
      modalContent.classList.remove("opacity-0", "scale-90");
    }, 20);
  }

  function closeModal() {
    const modal = document.getElementById("imageModal");
    const modalContent = document.getElementById("modalContent");

    modalContent.classList.add("opacity-0", "scale-90");
    modalContent.classList.remove("opacity-100", "scale-100");

    setTimeout(() => modal.classList.add("hidden"), 200);
  }

  document.getElementById("imageModal").addEventListener("click", function(e) {
    if (e.target === this) closeModal();
  });
  </script>

</body>
</html>
